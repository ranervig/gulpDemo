let recipes=[],modifier=1;async function getData(){const e=await fetch("/api");recipes=await e.json(),updateSelect()}function updateSelect(){for(a in select=document.querySelector("#recipeSelect"),select.options)select.options.remove(0);recipes.forEach(e=>{let t=document.createElement("option");t.value=e._id,t.text=e.recipe,select.appendChild(t)})}function displayInfo(e){let t=document.createElement("div");t.className="summaryInfo";let n=document.createElement("img");e.image?(n.src=e.path,n.alt=e.recipe,n.width="250",n.height="250"):(n.src="https://via.placeholder.com/250?text=No+Image+Provided",n.alt="No image"),t.appendChild(n);let i=new Date(e.timestamp);return t.insertAdjacentHTML("beforeend",` <p>Serves: ${e.servings*modifier}</span><br>
    Prep: ${e.prep} ${e.prephm}<br>
    Cook: ${e.cook} ${e.cookhm}<br>
    Added On: ${i.toLocaleDateString()}</p>
  `),t}function displayIngredients(e,t){let n=document.createElement("div");n.className="ingredientDisplay";let i=document.createElement("h3");i.textContent="Ingredients",n.append(i);let a=document.createElement("ul");a.id="ingredientList";let l=document.createElement("button");return l.innerText="Show",l.addEventListener("click",e=>{"none"==a.style.display?(l.innerText="Hide",a.style.display="block"):(l.innerText="Show",a.style.display="none")}),n.appendChild(l),e.forEach(e=>{let t=document.createElement("li");var n=e.amount*modifier;let i=e.unit;1<n&&"s"!==i.charAt(i.length-1)&&(i+="s"),t.innerHTML=`${e.amount*modifier} ${i} ${e.ingredient}`,a.appendChild(t)}),a.style.display=t,n.append(a),n}function displayInstructions(e,t){let n=document.createElement("div");n.className="instructionDisplay";let i=document.createElement("h3");i.textContent="Instructions",n.append(i);let a=document.createElement("ol");a.id="instructionList";let l=document.createElement("button");return l.innerText="Show",l.addEventListener("click",e=>{"visible"==a.className?(l.innerText="Hide",a.className=""):(l.innerText="Show",a.className="visible")}),n.appendChild(l),e.forEach(e=>{let t=document.createElement("li");t.textContent=e,a.appendChild(t)}),a.className=t,n.append(a),n}function displayRecipe(e,t,n){e=recipes[e];displayArea=document.querySelector(".recipeDisplay"),displayArea.innerHTML="";let i=document.createElement("H2");i.textContent=e.recipe,displayArea.append(i),displayArea.append(displayInfo(e)),displayArea.append(displayIngredients(e.ingredients,t)),displayArea.append(displayInstructions(e.instructions,n))}function addIngredient(){let e=document.createElement("p");e.innerHTML=`
  <label>Amount: <input type="number" name="ingredients" step=".1" min=".1"/></label>
  <label>Unit: <input list="measurementUS" name="ingredients" /></label>
  <label>Ingredient: <input type="text" name="ingredients" /></label>
  `,document.querySelector(".ingredients").appendChild(e)}function addInstruction(){let e=document.createElement("li");e.innerHTML='<input type="text" name="instructions" />',document.querySelector(".instructions > ol").appendChild(e)}function previewImage(e){let t=new FileReader;t.onload=()=>{let e=document.querySelector("#imagePreview");e.src=t.result},t.readAsDataURL(e.target.files[0])}function changeServings(e){modifier=e,displayRecipe(document.querySelector("#recipeSelect").selectedIndex,document.querySelector("#ingredientList").style.display,document.querySelector("#instructionList").className)}window.addEventListener("load",async()=>{await getData();let t=document.querySelector("#recipeSelect");0==t.length&&(t.style.display="none");let n=document.querySelector(".inputForm");n.style.display="none",0==recipes.length?(alert("No Recipes Found"),n.style.display="block"):displayRecipe(0,"none",""),t.addEventListener("change",e=>{displayRecipe(t.selectedIndex,document.querySelector("#ingredientList").style.display,document.querySelector("#instructionList").className)}),document.querySelector("#newRecipe").addEventListener("click",e=>{"none"!=n.style.display?n.style.display="none":n.style.display="block"});let e=document.querySelectorAll("[name=servingSelect]");e.forEach(e=>{e.addEventListener("click",()=>{changeServings(e.value)})}),document.querySelector("[name= 'photo']").addEventListener("change",e=>{previewImage(e)}),document.querySelector("#addIngredient").addEventListener("click",addIngredient),document.querySelector("#addInstruction").addEventListener("click",addInstruction),n.addEventListener("submit",async e=>{e.preventDefault(),e.stopPropagation();let t=await fetch("/api",{method:"post",body:new FormData(n)}).catch(e=>{console.log(e)});await t.json();await getData()})});